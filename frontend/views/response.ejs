<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=
    , initial-scale=1.0">
    <title>Document</title>
    <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />
  <style>
    body {
      font-family: Arial, sans-serif;
      height: 100vh;
      margin: 0;
      background: url('/static/images/image copy 3.png') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }

  </style>
    <script>
        async function getUserResponse(){
            const path=window.location.pathname.split("/");
            console.log(path)
            const token=localStorage.getItem("token");
            const userResponse=await fetch(`http://localhost:5000/admin/form/${parseInt(path[2])}/responses/${path[4]}`,{headers:{Authorization:`Bearer ${token}`}});
            return userResponse;
        }
        async function getForm(){
            const path=window.location.pathname.split("/");
            console.log(path)
            const token=localStorage.getItem("token");
            const userResponse=await fetch(`http://localhost:5000/admin/form/${parseInt(path[2])}`,{headers:{Authorization:`Bearer ${token}`}});
            const responsejson=await userResponse.json();
            console.log(responsejson);
            return responsejson;

        }
        document.addEventListener("DOMContentLoaded",function(){

          const form =getForm().then(formData=>{

            getUserResponse().then(data=>data.json()).then((data,index)=>{
                const formObject=formData["data"]["formFields"];
                const form=document.getElementsByTagName("form")[0];
                data=data["data"][0]["responses"];
                console.log(data);
                for(let i=0;i<formObject.length;i++){
                    console.log(formObject[i]);
                    if(Object.keys(formObject[i])[0]==="radio"){
                        const mainLabel = document.createElement("label");
                        mainLabel.classList.add("form-label", "d-block");
                        mainLabel.textContent =  formObject[i][Object.keys(formObject[i])[0]]["mainLabel"];
                        form.appendChild(mainLabel);

                        formObject[i][Object.keys(formObject[i])[0]].options.forEach((dat, ind) => {
                        const divElement = document.createElement("div");
                        divElement.classList.add("form-check", "form-check-inline");

                        const inp = document.createElement("input");
                        inp.setAttribute("type", "radio");
                        inp.setAttribute("value", dat);
                        inp.setAttribute("id", `radio-${dat}-${index}`);
                        inp.setAttribute("name", `radioGroup${index}`);
                        inp.classList.add("form-check-input");
                        if(data[i]===dat){
                            inp.setAttribute("checked","");
                        }
                        const label = document.createElement("label");
                        label.textContent = dat;
                        label.setAttribute("for", `radio-${dat}-${index}`);
                        label.classList.add("form-check-label");

                        divElement.appendChild(inp);
                        divElement.appendChild(label);
                        form.appendChild(divElement);
                });
                    }
                    else if (Object.keys(formObject[i])[0] === "checkbox") {
    const options = formObject[i]["checkbox"].options || [];
    const mainLabelText =  formObject[i][Object.keys(formObject[i])[0]]["mainLabel"];
 
    if (options.length === 0) {
        const divElement = document.createElement("div");
        divElement.classList.add("form-check");
 
        const inp = document.createElement("input");
        inp.setAttribute("type", "checkbox");
        inp.setAttribute("id", `radio-single-${index}`);
        inp.setAttribute("name", `radioGroup${index}`);
        inp.classList.add("form-check-input");
 
        const mainLabel = document.createElement("label");
        mainLabel.setAttribute("for", `radio-single-${index}`);
        mainLabel.classList.add("form-check-label");
        mainLabel.textContent = mainLabelText;
 
 
        if (data[i]) {
                inp.setAttribute("checked", "");
            }
 
        divElement.appendChild(inp);
        divElement.appendChild(mainLabel);
        form.appendChild(divElement);
    }
  }
  else if (Object.keys(formObject[i])[0] === "select") {
                const divWrapper = document.createElement("div");
                divWrapper.classList.add("mb-3");

                const label = document.createElement("label");
                label.setAttribute("for", `select-${opt}`);
                label.textContent = `Choose ${inputElement["mainLabel"]}`;

                const selectDiv = document.createElement("select");
                selectDiv.classList.add("form-select");
                selectDiv.setAttribute("id", `select-${opt}`);

                formObject[i][Object.keys(formObject[i])[0]].options.forEach((dat) => {
                  const option = document.createElement("option");
                  option.setAttribute("value", dat);
                  option.textContent = dat;
                  selectDiv.appendChild(option);
                });
                selectDiv.value=data[i];
                divWrapper.appendChild(label);
                divWrapper.appendChild(selectDiv);
                form.appendChild(divWrapper);
              } 
              else if (Object.keys(formObject[i])[0] === "textArea") {
                const divElement = document.createElement("div");
                divElement.classList.add("mb-3");

                const label = document.createElement("label");
                label.textContent = formObject[i][Object.keys(formObject[i])[0]]["mainLabel"] || "Text Area";
                label.classList.add("form-label");
                label.setAttribute("for", `${formObject[i][Object.keys(formObject[i])[0]]["mainLabel"][0] || "textarea"}-${index}`);

                const textarea = document.createElement("textarea");
                textarea.classList.add("form-control");
                textarea.setAttribute("id", `${formObject[i][Object.keys(formObject[i])[0]]["mainLabel"][0] || "textarea"}-${index}`);
                textarea.setAttribute("name", `${formObject[i][Object.keys(formObject[i])[0]]["mainLabel"][0] || "textarea"}-${index}`);

                if (formObject[i][Object.keys(formObject[i])[0]].inputValidation) {
                    formObject[i][Object.keys(formObject[i])[0]].inputValidation.forEach((ele) => {
                    if (ele["prop"] && ele["val"]) {
                      textarea.setAttribute(ele["prop"], ele["val"]);
                    }
                  });
                }
                textarea.value=data[i];
                if (formObject[i][Object.keys(formObject[i])[0]].shortHand) {
                    formObject[i][Object.keys(formObject[i])[0]].shortHand.forEach((ele) => {
                    if (ele) {
                      textarea.setAttribute(ele, "");
                    }
                  });
                }

                divElement.appendChild(label);
                divElement.appendChild(textarea);
                form.appendChild(divElement);
              } 
              else if (["date", "email", "number", "file", "color", "range", "tel", "datetime-local","text"].includes(Object.keys(formObject[i])[0])) {
                const divElement = document.createElement("div");
                divElement.classList.add("mb-3");

                const label = document.createElement("label");
                label.textContent = formObject[i][Object.keys(formObject[i])[0]]["mainLabel"] || "Label";
                label.classList.add("form-label");
                label.setAttribute("for", `${formObject[i][Object.keys(formObject[i])[0]]["mainLabel"] || "input"}-${index}`);

                const inp = document.createElement("input");
                inp.setAttribute("type", Object.keys(formObject[i])[0]);
                inp.classList.add("form-control");
                inp.setAttribute("id", `${formObject[i][Object.keys(formObject[i])[0]]["mainLabel"] || "input"}-${index}`);
                inp.setAttribute("name", `${formObject[i][Object.keys(formObject[i])[0]]["mainLabel"] || "input"}-${index}`);
                inp.setAttribute("value",data[i]);
                if (formObject[i][Object.keys(formObject[i])[0]].inputValidation) {
                    formObject[i][Object.keys(formObject[i])[0]].inputValidation.forEach((ele) => {
                    if (ele["prop"] && ele["val"]) {
                      inp.setAttribute(ele["prop"], ele["val"]);
                    }
                  });
                }

                if (formObject[i][Object.keys(formObject[i])[0]].shortHand) {
                    formObject[i][Object.keys(formObject[i])[0]].shortHand.forEach((ele) => {
                    if (ele) {
                      inp.setAttribute(ele, "");
                    }
                  });
                }

                divElement.appendChild(label);
                divElement.appendChild(inp);
                form.appendChild(divElement);
              }
                    
                }
              

                

        }).catch(err=>console.log(err));

          }).catch(err=>console.log(err))
        })

    </script>
</head>
<body>
    <form action=""></form>
</body>
</html>